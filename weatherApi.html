<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather API</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
<body style="background: linear-gradient(to left,blue,yellow);">
    <div id="err"></div>
    <section class="row mx-0 justify-content-around p-3">
        <h3 class="text-center mt-5 w-100">Weather Information</h3>
        <div class="col-md-6 mx-auto border shadow rounded-5 bg-white p-3" style="border-radius: 25px;">
            <h3 class="text-center border-bottom p-2">Select Location</h3>
            <label for="net" class="font-weight-bold">Location</label>
            <input type="text" class="form-control custom-select-lg" id="location" placeholder="Enter Location Name" >
                
            <div class="mt-3">

                <button type="button" class="btn btn-warning btn-lg" id="generate">Search Location</button>
                <button class="btn btn-primary btn-lg" id="" onclick="currentLocation()">Current Location</button>
            </div>
            <div id="content"></div>
            
        </div>
        <div id="viewWeather" class="col-md-5 "></div>
    </section>

    <script>

        let ApiKey = 'bf84db9e7eb96bcb6a21dcf7818b4e76'
        // Search Location by Name
        function searchLocationByName(e) {
            e.preventDefault();
            let locationName = document.getElementById('location').value;
            let url = `http://api.openweathermap.org/geo/1.0/direct?q=${locationName}&limit=5&appid=${ApiKey}`;
            fetch(url)
        .then(res => res.json())
        .then(data => {
            
            content.innerHTML = `
                <table class="table table-striped table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Country</th>
                        <th>Name</th>
                        <th>State</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="locations">
                   
                </tbody>

            </table>
            `
            locations.innerHTML = '';
            data.forEach(element => {
                locations.innerHTML += `
                    <tr>
                        <td>${element.country}</td>
                        <td>${element.name}</td>
                        <td>${element.state || ''}</td>
                        <td><button class="btn btn-info" onclick="showWeather('${element.lat}', '${element.lon}')">Show</button></td>
                    </tr>
                `;
            });
        })
    }
        document.getElementById('generate').addEventListener('click', searchLocationByName);

        // Show Weather by latitude and longitude
        function showWeather(lat, lon) {
            let url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${ApiKey}`;
            fetch(url)
        .then(res => res.json())
        .then(data => {
            console.log("Weather Data:", data);
            viewWeather.innerHTML = `
                <div class="w-100  border shadow rounded-5 bg-white p-3" style="border-radius: 25px;">
            <h3 class="text-center border-bottom p-2">View Weather</h3>
            <div id="weather"></div>
        </div>
            `
            weather.innerHTML = `
                <h1 class='text-center'>${data.name}</h1>
                <p><b>Weather:</b> ${data.weather[0].description}</p>
                <p><b>Temperature:</b> ${(data.main.temp - 273.15).toFixed(2)} °C</p>
                <p><b>Temperature Min:</b> ${(data.main.temp_min - 273.15).toFixed(2)} °C</p>
                <p><b>Temperature Max:</b> ${(data.main.temp - 273.15).toFixed(2)} °C</p>
                <p><b>Humidity:</b> ${data.main.humidity} %</p>
                <p><b>Wind Speed:</b> ${data.wind.speed} m/s</p>
                <p><b>Wind Direction:</b> ${data.wind.deg}°</p>
                <p><b>Atmospheric Pressure:</b> ${data.main.pressure} hPa</p>
            `;
        })
        .catch(error => {
            err.innerHTML = "<h2>Error Message: " + error.message + '</h2>';
            console.error("Error:", error);
        });
    }
    function currentLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                let lat = position.coords.latitude;
                let lon = position.coords.longitude;
                showWeather(lat, lon);
            });
        } else {
            err.innerHTML = "<h2>Geolocation is not supported by this browser.</h2>";
        }
    }
        function showWeatherDirectlyByName(params) {
            
            let url = 'https://api.openweathermap.org/data/2.5/weather?q=lagos&appid=bf84db9e7eb96bcb6a21dcf7818b4e76';
            fetch(url)
        .then(res => res.json())
        .then(data => {
            console.log("Weather Data:", data);
            
            weather.innerHTML = `
                <h1 class='text-center'>${data.name}</h1>
                <p><b>Weather</b>: ${data.weather[0].description}</p>
                <p><b>Temperature:</b> ${(data.main.temp - 273.15).toFixed(2)} °C</p>
            `;
        })
        .catch(error => {
            err.innerHTML = "<h2>Error Message: " + error.message + '</h2>';
            console.error("Error:", error);
        });
    }
    </script>
</body>
</html>